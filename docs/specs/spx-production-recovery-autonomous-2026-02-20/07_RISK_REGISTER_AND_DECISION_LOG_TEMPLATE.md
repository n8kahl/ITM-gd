# Risk Register and Decision Log Template: SPX Autonomous Recovery
Date: February 20, 2026

## 1. Purpose
Track execution risks, mitigations, and architecture/process decisions for autonomous SPX production delivery.

## 2. Risk Scoring Model
1. Likelihood: 1 (low) to 5 (high)
2. Impact: 1 (low) to 5 (high)
3. Risk score: likelihood x impact
4. Priority guide:
- 16-25: critical
- 9-15: high
- 4-8: medium
- 1-3: low

## 3. Risk Register Template
```md
| Risk ID | Date | Category | Description | Likelihood | Impact | Score | Phase | Owner | Mitigation | Trigger | Status |
|---|---|---|---|---:|---:|---:|---|---|---|---|---|
| R-001 | YYYY-MM-DD | State Safety | ... | 4 | 5 | 20 | Phase 1 | Eng | ... | ... | Open |
```

## 4. Decision Log Template
```md
| Decision ID | Date | Phase | Decision | Options Considered | Chosen Option | Rationale | Tradeoffs | Owner | Status |
|---|---|---|---|---|---|---|---|---|---|
| D-001 | YYYY-MM-DD | Phase 2 | Command registry shape | A/B/C | B | ... | ... | Eng | Accepted |
```

## 5. Initial Risk Seed List
| Risk ID | Date | Category | Description | Likelihood | Impact | Score | Phase | Owner | Mitigation | Trigger | Status |
|---|---|---|---|---:|---:|---:|---|---|---|---|---|
| R-001 | 2026-02-20 | State Safety | Invalid state transitions reappear during refactor | 3 | 5 | 15 | 1-3 | Eng | State-machine tests + render guards | Contradictory CTA/state UI | Open |
| R-002 | 2026-02-20 | Command Consistency | Command availability diverges across surfaces | 4 | 4 | 16 | 2 | Eng | Single registry + parity tests | Shortcut vs palette mismatch | Open |
| R-003 | 2026-02-20 | Data Trust | Feed fallback behavior is inconsistent under outages | 3 | 5 | 15 | 7 | Eng | Orchestrator + fallback contract tests | Stale badge not matching true state | Open |
| R-004 | 2026-02-20 | Performance | Rich chart interactions degrade responsiveness | 3 | 4 | 12 | 9 | Eng | Performance budgets + throttle policy | Frame drops or delayed actions | Open |
| R-005 | 2026-02-20 | Operational | Release branch includes unintended file changes | 2 | 5 | 10 | All | Eng | Diff hygiene checks per slice | Unexpected modified file set | Open |

## 6. Initial Decision Seed List
| Decision ID | Date | Phase | Decision | Options Considered | Chosen Option | Rationale | Tradeoffs | Owner | Status |
|---|---|---|---|---|---|---|---|---|---|
| D-001 | 2026-02-20 | 2 | Use canonical command registry | Local handlers per surface, shared registry | Shared registry | Eliminates duplicate behavior and test drift | Upfront refactor complexity | Eng | Accepted |
| D-002 | 2026-02-20 | 4 | Overlay model | Freeform toggles, preset model | Preset model with advanced drawer | Reduces cognitive load and production risk | Less immediate toggle granularity | Eng | Accepted |
| D-003 | 2026-02-20 | 7 | Data ingest architecture | Component-level parsing, orchestrator service | Orchestrator service | Deterministic trust/fallback behavior | More core plumbing work | Eng | Accepted |

## 7. Update Rules
1. Add risk entries before starting a high-risk slice.
2. Update risk status when mitigations land.
3. Record architecture/process decisions when alternatives are evaluated.
4. Never close a critical/high risk without evidence.

## 8. Closeout Criteria
Before release:
1. No unresolved critical risk without approved exception.
2. All high risks have owner, mitigation, and monitoring trigger.
3. All accepted decisions document rationale and tradeoffs.

## 9. Execution Updates (2026-02-20)
### Risk Register Updates
| Risk ID | Date | Category | Description | Likelihood | Impact | Score | Phase | Owner | Mitigation | Trigger | Status |
|---|---|---|---|---:|---:|---:|---|---|---|---|---|
| R-001 | 2026-02-20 | State Safety | Invalid state transitions reappear during refactor | 3 | 5 | 15 | 1-3 | Eng | State-machine tests + render guards | Contradictory CTA/state UI | Open |
| R-005 | 2026-02-20 | Operational | Release branch includes unintended file changes | 2 | 5 | 10 | All | Eng | Diff hygiene checks per slice | Unexpected modified file set | Open |
| R-006 | 2026-02-20 | UX Contract | Contract selector may treat user-selected alternative as canonical card, hiding AI revert CTA | 4 | 4 | 16 | 1 | Eng | Keep AI recommendation cached/displayed as canonical base while preserving alternative selection state | `Use AI Recommendation` action missing after alt selection | Mitigated |
| R-007 | 2026-02-20 | UX Contract | Coach timeline/history regressions hide action chips and message context | 4 | 4 | 16 | 1 | Eng | Default-open timeline + explicit `All` control + lifecycle-backed pinned lane | Coach message/action chip contracts fail | Mitigated |
| R-002 | 2026-02-20 | Command Consistency | Command availability diverges across surfaces | 4 | 4 | 16 | 2 | Eng | Shared registry execution now used by keyboard + palette + action strip | Keyboard/palette/action-strip mismatch | Mitigated |
| R-008 | 2026-02-20 | Architecture | Central command registry regressions can affect multiple surfaces at once | 3 | 4 | 12 | 2 | Eng | Keep critical SPX E2E command suite as required post-change gate | Any command contract break after registry edits | Open |
| R-009 | 2026-02-20 | Refactor Safety | Controller extraction leaves stale page references, causing runtime crashes | 3 | 5 | 15 | 3 | Eng | Enforce controller return contract + lint + SPX critical E2E gate | Runtime `ReferenceError`/missing render contracts after extraction | Mitigated |
| R-010 | 2026-02-20 | Runtime Resilience | Service worker registration object may be undefined, crashing routes during boot | 2 | 4 | 8 | 3 | Eng | Guard registration object before lifecycle field access | `Cannot read properties of undefined (reading 'waiting')` | Mitigated |
| R-011 | 2026-02-20 | Static Gate | Typed mock call tuples in unrelated tests can block repository-level `tsc` gate | 3 | 3 | 9 | 3/6 | Eng | Explicit mock arg signatures + matcher assertions that avoid tuple index assumptions | `TS2493` on `mock.calls[0][0]` | Mitigated |
| R-012 | 2026-02-20 | Contract Drift | Shell container prop contracts can diverge from controller return shape after future edits | 3 | 4 | 12 | 3 | Eng | Export `SPXCommandController` type and consume directly in container props + keep lint/tsc/E2E gate | Build/test failures or silent surface behavior drift | Mitigated |
| R-013 | 2026-02-20 | Spatial Rendering | Desktop spatial canvas extraction can miswire overlay or chart callback behavior | 3 | 4 | 12 | 3 | Eng | Dedicated spatial component with explicit prop interface + SPX critical E2E gate | Overlay visibility or chart interaction contract regressions | Mitigated |
| R-014 | 2026-02-20 | Control Orchestration | Desktop control shell extraction can desync classic/spatial action-strip semantics | 3 | 4 | 12 | 3 | Eng | Centralized desktop orchestrator with explicit mode-aware config + SPX critical E2E gate | Divergent control behavior between classic and spatial views | Mitigated |
| R-015 | 2026-02-20 | Mobile Orchestration | Mobile smart-stack and tabbed paths can diverge during container refactor | 3 | 4 | 12 | 3 | Eng | Dedicated mobile orchestrator + explicit prop contract + SPX critical E2E gate | Smart-stack/tab mode behavior mismatch | Mitigated |
| R-016 | 2026-02-20 | Adapter Contract Drift | Shell adapter module can desync from child surface prop contracts, causing silent wiring regressions | 3 | 4 | 12 | 3 | Eng | Export child surface prop types and bind adapter function signatures to those types + SPX critical E2E gate | Build failures or cross-surface behavior mismatch after surface prop edits | Mitigated |
| R-017 | 2026-02-20 | Layout Policy Drift | Desktop panel sizing/skeleton gating logic can diverge during refactor and subtly change spatial balance | 3 | 4 | 12 | 3 | Eng | Consolidate desktop classic layout policy in one typed selector + SPX critical E2E gate | Unexpected desktop panel proportions or skeleton visibility regressions | Mitigated |
| R-018 | 2026-02-20 | Exit Cleanup Drift | Phase 3 exit cleanup can leave inline route/container policy logic partially migrated, causing fallback/render inconsistencies | 3 | 4 | 12 | 3 | Eng | Dedicated coach preview component + typed desktop view/layout selectors + SPX critical E2E gate | Fallback card or desktop branch behavior diverges post-cleanup | Mitigated |
| R-019 | 2026-02-20 | Preset Integrity | Overlay preset state can diverge from active toggle state, creating misleading preset labeling or non-deterministic transitions | 3 | 4 | 12 | 4 | Eng | Canonical preset state contract + controller resolver + SPX critical E2E regression gate | Preset button active state mismatches visible overlays | Mitigated |
| R-020 | 2026-02-20 | HUD Packaging Drift | Moving advanced controls into drawer/HUD can break discoverability or selector contracts if controls are conditionally removed | 3 | 4 | 12 | 4 | Eng | Keep advanced controls selector-addressable while visually grouped in optional HUD drawer + expanded overlay/view-mode E2E gate | Overlay controls unavailable or non-interactive after HUD packaging | Mitigated |
| R-021 | 2026-02-20 | CTA Hierarchy Drift | New execution-rail primary CTA can conflict with other CTA surfaces if mode derivation is inconsistent | 3 | 4 | 12 | 5 | Eng | Controller-owned primary CTA contract + dedicated CTA hierarchy E2E + full SPX suite gate | Primary CTA label/action mismatches active state progression | Mitigated |
| R-022 | 2026-02-20 | Mobile Action Drift | Mobile setup/coach actions may compete with primary flow, causing unclear execution path and duplicate controls | 3 | 4 | 12 | 5 | Eng | Mobile primary-action rail + setup-feed local CTA suppression + coach action de-duplication + dedicated mobile coach hierarchy E2E | Multiple conflicting primary CTAs appear on mobile | Mitigated |
| R-023 | 2026-02-20 | Signal Clarity Drift | Header trust chips and focus states may regress under stale/degraded transitions, reducing decision readability and keyboard accessibility | 3 | 3 | 9 | 5 | Eng | Explicit header chip contracts + focus-visible polish + dedicated header-clarity E2E and full SPX suite gate | Header health/feed signal becomes ambiguous or keyboard focus is not visible | Mitigated |
| R-024 | 2026-02-20 | Cleanup Hygiene Drift | Repository cleanup changes could over-ignore or under-ignore local artifacts, causing release noise or hidden files | 2 | 4 | 8 | 6 | Eng | Narrowly scoped ignore/lint exclusions + explicit archive governance docs + final static/build gate run | Release branch includes temp/swap/prototype artifacts or lint hard-fails on local mockups | Mitigated |
| R-025 | 2026-02-21 | Feed Trust | Event-normalization/orchestrator mismatch could produce false stale/degraded transitions under partial metadata streams | 3 | 4 | 12 | 7 | Eng | Backwards-compatible parser defaults + synthetic heartbeat ingest from price ticks + unit + full SPX E2E gate | Frequent trust-state flips or stale state while tick feed is healthy | Mitigated |
| R-026 | 2026-02-21 | Safety Gating | Reason-code trust gating can over-block legitimate entry actions if fallback reasons are too broad or mis-prioritized | 3 | 4 | 12 | 7 | Eng | Block only high-risk reason codes; expose reason labels in header/action controls; validate with unit + full SPX E2E suite | Entry CTA disabled during benign fallback modes | Mitigated |
| R-027 | 2026-02-21 | Decision Quality | New scoring weights can reorder setup priority unexpectedly if alignment/confidence model is non-deterministic or overfit to narrow contexts | 3 | 4 | 12 | 8 | Eng | Pure deterministic scoring function + fixture-based tests + preserve status/tier ordering precedence | Setup ordering churns between identical data snapshots | Mitigated |
| R-028 | 2026-02-21 | Risk Envelope | Entry-gate thresholds can be over-calibrated and block normal flows, causing command/CTA regressions and false risk rejects | 3 | 4 | 12 | 8 | Eng | Conservative defaults + reason-code telemetry + command/CTA E2E coverage + threshold calibration pass | Entry flow blocked for healthy setups in baseline E2E mocks | Mitigated |
| R-029 | 2026-02-21 | Explainability Clarity | Adding deterministic explainability lines can over-expand coach payloads and reduce clarity if line inflation is uncontrolled | 2 | 3 | 6 | 8 | Eng | Unique-line dedupe + fixed max lines + preserve existing backend `why` ordering priority | Coach decision cards become verbose/noisy and hide primary guidance | Mitigated |
| R-030 | 2026-02-21 | Replay Determinism | Replay controls can diverge from chart state and produce non-deterministic frame windows across sessions | 3 | 4 | 12 | 9 | Eng | Deterministic replay engine with checksum/frame contract + controller-owned replay state + dedicated E2E coverage | Replay frame progression differs for identical journals | Mitigated |
| R-031 | 2026-02-21 | Visual Signal Density | Scenario lanes and focus controls can increase chart/surface density and dilute critical signals | 2 | 3 | 6 | 9 | Eng | Fixed 3-lane model + compact lane badges + focus-mode control semantics + E2E scope checks | Operators report clutter or ambiguous lane meaning | Mitigated |
| R-032 | 2026-02-21 | Journal Integrity | Auto journal capture can create low-quality artifacts if trade exits are processed without active trade context | 3 | 4 | 12 | 10 | Eng | `exitTrade` guard requires active setup; capture schema includes explicit null-safe fields + E2E validation | Spurious journal artifacts appear without a trade cycle | Mitigated |
| R-033 | 2026-02-21 | Governance Drift | Feature flags may lack lifecycle ownership metadata and become permanent technical debt | 3 | 3 | 9 | 10 | Eng | Full metadata catalog + coverage-gap helper + runbook update discipline | New flags appear without owner/removal conditions | Mitigated |
| R-034 | 2026-02-21 | Test Contract | E2E mobile state assertions can become ambiguous when identical text labels exist in multiple chips within one scope | 2 | 2 | 4 | 10-closeout | Eng | Add deterministic mode-chip test IDs and avoid broad text-only strict locators | Playwright strict-mode violation on duplicate state labels | Mitigated |
| R-035 | 2026-02-21 | Runtime Gate | Final release evidence can be invalid if commands are only run on non-target Node runtime | 2 | 4 | 8 | 10-closeout | Eng | Re-run full release gates under Node `v22.12.0` and capture results in tracker/release notes | Engine mismatch warnings leave release posture ambiguous | Mitigated |

### Decision Log Updates
| Decision ID | Date | Phase | Decision | Options Considered | Chosen Option | Rationale | Tradeoffs | Owner | Status |
|---|---|---|---|---|---|---|---|---|---|
| D-004 | 2026-02-20 | 1 | Coach timeline discoverability baseline | Keep collapsed history preview, default-open timeline | Default-open timeline while preserving history toggle | Restores message/action-chip discoverability and jump-to-latest contracts | More history content visible by default | Eng | Accepted |
| D-005 | 2026-02-20 | 1 | Contract base-card source of truth | Bind card to selected contract, bind card to AI recommendation cache | Bind card to AI recommendation cache | Prevents revert CTA dead-ends while alternatives remain selectable | Adds dependency on recommendation cache consistency | Eng | Accepted |
| D-006 | 2026-02-20 | 1 | Coach pinned alert lane restore strategy | Rebuild minimal local lane, reuse lifecycle v2 module | Reuse lifecycle v2 module in active coach feed | Preserves persistence and compatibility with existing lifecycle store/tests | More UI/state coupling inside coach feed component | Eng | Accepted |
| D-007 | 2026-02-20 | 2 | Command consolidation path | Keep duplicated in-page trees, move to shared registry hook | Shared registry hook + command contract module | Removes duplicated execution branches while keeping behavior-compatible command set | New shared layer requires stricter regression gates | Eng | Accepted |
| D-008 | 2026-02-20 | 2 | Action-strip command execution parity | Keep action strip as independent toggles, route through shared registry | Route action-strip callbacks to shared registry | Eliminates remaining command drift path and completes phase parity model | Registry changes now affect action strip too | Eng | Accepted |
| D-009 | 2026-02-20 | 3 | Page orchestration extraction boundary | Keep controller logic in page, extract dedicated hook boundary | Extract `useSPXCommandController` and wire page to returned contract | Reduces shell complexity and enables safer incremental decomposition | Requires strict contract discipline between hook and page | Eng | Accepted |
| D-010 | 2026-02-20 | 3 | Service worker boot safety behavior | Assume registration object exists, guard undefined registration | Guard undefined registration before update lifecycle handling | Prevents route-level runtime crashes in non-standard registration contexts | Slightly less aggressive update lifecycle execution in abnormal environments | Eng | Accepted |
| D-011 | 2026-02-20 | 3 | Shell decomposition strategy | Keep inline render helper closures, extract reusable shell section components | Extract `spx-command-center-shell-sections.tsx` and rewire page to explicit section components | Reduces page sprawl while preserving route-level orchestration ownership | Adds a section-prop contract that must be maintained | Eng | Accepted |
| D-012 | 2026-02-20 | 3 | Mobile/Desktop branch extraction approach | Keep branches inline in route page, move to dedicated shell container components | Move branches to `spx-command-center-shell-containers.tsx` and keep page as thin orchestrator | Improves maintainability and enables focused follow-on decomposition | Introduces additional file boundaries and prop routing complexity | Eng | Accepted |
| D-013 | 2026-02-20 | 3 | Spatial desktop decomposition boundary | Keep spatial canvas inline inside desktop container, extract dedicated spatial canvas component | Extract `spx-desktop-spatial-canvas.tsx` and compose from desktop container | Isolates highest-complexity desktop rendering zone for safer future iteration | Adds another component interface to maintain | Eng | Accepted |
| D-014 | 2026-02-20 | 3 | Desktop control orchestration boundary | Keep duplicated header/action-strip/sidebar composition in container branches, extract dedicated orchestrator component | Extract `spx-desktop-surface-orchestrator.tsx` and route both classic/spatial branches through it | Removes duplicated mode-control logic and centralizes control semantics | Adds orchestration interface that must be kept aligned with controller actions | Eng | Accepted |
| D-015 | 2026-02-20 | 3 | Mobile orchestration boundary | Keep mobile smart-stack/tab logic inline in container, extract dedicated mobile orchestrator component | Extract `spx-mobile-surface-orchestrator.tsx` and keep container as motion wrapper + contract mapper | Aligns mobile architecture with desktop orchestration model and reduces branch complexity | Adds additional orchestrator interface to maintain | Eng | Accepted |
| D-016 | 2026-02-20 | 3 | Shell adaptation boundary | Keep controller-to-surface mapping inline in container components, extract a dedicated shell adapter module with typed contracts | Extract `spx-command-center-shell-adapters.ts` and route container composition through adapter outputs | Reduces prop fan-out and centralizes callback/prop contract mapping for safer incremental refactors | Adds one shared adapter boundary that must stay synchronized with surface contracts | Eng | Accepted |
| D-017 | 2026-02-20 | 3 | Desktop layout policy boundary | Keep desktop sizing/skeleton policy inline in container, extract a typed layout-policy selector | Extract `createDesktopClassicLayoutPolicy` in shell adapters and consume in container composition | Makes layout behavior auditable and prevents policy logic scattering during future refactors | Introduces one more selector contract that must remain aligned with UX intent | Eng | Accepted |
| D-018 | 2026-02-20 | 3 | Route shell fallback boundary | Keep coach preview fallback inline inside route page, extract dedicated preview component and selector-driven container branching | Extract `spx-coach-preview-card.tsx` and use adapter-driven desktop view policy in containers | Completes route-shell cleanup and makes fallback/render policy boundaries explicit before Phase 4 work | Adds one more component/selector contract to maintain | Eng | Accepted |
| D-019 | 2026-02-20 | 4 | Overlay preset packaging baseline | Keep freeform overlay toggles only, introduce canonical preset contract layered over existing toggles | Add `execution`/`flow`/`spatial` preset contract and wire through controller/action-strip while preserving manual toggles | Delivers deterministic packaging with minimal regression risk and incremental path to advanced drawer migration | Adds preset-state resolver complexity that must remain in sync with overlay toggles | Eng | Accepted |
| D-020 | 2026-02-20 | 4 | Advanced overlay control packaging | Keep advanced toggles on primary action rail, move to optional Advanced HUD drawer while preserving existing selectors | Move freeform overlay/panel/immersive toggles into `Advanced HUD` drawer and retain selector IDs/contracts | Reduces primary-rail clutter and aligns with progressive disclosure requirement without breaking existing automation/tests | Adds drawer state UX to maintain and educate users on discoverability | Eng | Accepted |
| D-021 | 2026-02-20 | 5 | Execution-rail primary CTA hierarchy | Keep existing distributed CTAs only, add one controller-driven dominant CTA in execution rail | Add state-aware primary CTA contract (`scan/evaluate/in_trade`) and render it in ActionStrip | Improves clarity by surfacing one dominant action per state without removing existing secondary affordances | Requires ongoing alignment between controller state machine and CTA copy/behavior | Eng | Accepted |
| D-022 | 2026-02-20 | 5 | Mobile/coach action-density strategy | Keep all setup/coach buttons always visible, enforce single mobile primary rail and progressively disclose secondary prompts | Add mobile primary-action rail, suppress setup local primaries on mobile, collapse coach quick prompts by default, and de-duplicate decision actions | Restores one-primary-action-per-state principle on mobile while preserving advanced actions as secondary paths | Adds extra disclosure step for quick prompts and requires selector-level coverage for new rail/toggle contracts | Eng | Accepted |
| D-023 | 2026-02-20 | 5 | Header trust-signal presentation strategy | Show health only on failure states, always show explicit health/feed/levels chips with fixed contract | Always render explicit trust chips with mode-aware tone and add header clarity test coverage | Keeps signal model predictable during high-speed execution and reduces ambiguity when feed state changes | Slightly denser header layout with more persistent status elements | Eng | Accepted |
| D-024 | 2026-02-20 | 6 | Cleanup and archive policy for production branch | Delete all local prototype artifacts, preserve prototypes but scope them out of release gates with explicit archive governance | Preserve prototypes but add narrow ignore/lint boundaries, remove transient swap files, and add superseded-spec archive index | Keeps traceability and local iteration artifacts available while restoring release gate stability | Requires ongoing discipline to keep ignore scope narrow and archive index current | Eng | Accepted |
| D-025 | 2026-02-21 | 7 | Feed trust architecture boundary | Keep health logic inline in context, extract dedicated event-schema + orchestrator + feed-health modules | Extract dedicated modules and integrate context through resolver contract | Creates deterministic, testable trust-state behavior and reduces context complexity before deeper reliability phases | Adds one orchestration boundary that must remain aligned with upstream event semantics | Eng | Accepted |
| D-026 | 2026-02-21 | 7 | Fallback-policy reason code scope | Block entry on all stale states, block only high-risk reason codes while surfacing explicit operator labels | Block only high-risk reason codes and keep lower-risk fallback modes actionable | Balances execution safety with continuity by preventing unsafe entries without deadlocking normal fallback operation | Requires clear reason taxonomy and disciplined precedence ordering | Eng | Accepted |
| D-027 | 2026-02-21 | 8 | Decision scoring rollout strategy | Keep backend ordering only, introduce deterministic client scoring enrichment | Introduce deterministic client scoring enrichment while preserving status/tier guardrails | Improves local ranking clarity and explainability without waiting on backend model migrations | Requires maintaining scoring weights and validating against production behavior over time | Eng | Accepted |
| D-028 | 2026-02-21 | 8 | Risk-envelope default threshold strategy | Enforce strict alignment/confidence thresholds by default, start with conservative defaults and block only hard-risk reasons out of the box | Start with conservative defaults and keep optional threshold knobs for stricter rollout | Preserves flow reliability while enabling staged tightening once live telemetry confidence is high | Lower immediate strictness until operational baselines are established | Eng | Accepted |
| D-029 | 2026-02-21 | 8 | Coach explainability enrichment strategy | Keep backend `why` as-is, append deterministic setup drivers/risks/freshness with controlled limits | Append deterministic setup explainability with dedupe/caps while preserving existing `why` precedence | Ensures fallback and sparse backend responses still provide actionable context without requiring backend contract migration first | Requires maintaining enrichment logic and avoiding over-verbose composition | Eng | Accepted |
| D-030 | 2026-02-21 | 9 | Replay architecture boundary | UI-local playback loops, deterministic replay engine module | Deterministic replay engine module with checksum + frame contract | Ensures repeatable playback and simplifies validation of replay correctness | Requires maintaining normalized bar ingestion assumptions | Eng | Accepted |
| D-031 | 2026-02-21 | 9 | Focus-mode interaction model | Implicit mode from layout only, explicit user-selectable focus mode | Explicit focus mode (`decision`, `execution`, `risk_only`) owned by controller | Gives operators direct control over information density and task intent | Adds one additional state model that must remain synced across surfaces | Eng | Accepted |
| D-032 | 2026-02-21 | 10 | Trade-journal persistence strategy | Server-only journaling, client-local immediate capture | Client-local immediate capture on trade exit with deterministic artifact schema | Delivers autonomous artifact coverage without backend dependency and validates flow before server integration | Local-only persistence requires future backend sync step | Eng | Accepted |
| D-033 | 2026-02-21 | 10 | Flag governance enforcement model | Manual docs-only ownership tracking, metadata contract in code | Code-level metadata catalog + coverage checks in tests | Prevents silent flag lifecycle drift and keeps governance auditable in CI | Metadata must be updated in tandem with each new flag | Eng | Accepted |
| D-034 | 2026-02-21 | 10-closeout | Mobile state selector contract for E2E | Continue text-only assertions, add deterministic test IDs to state chips | Add deterministic mode-chip test IDs and assert those in E2E | Prevents strict-locator collisions when UX intentionally repeats state labels across chips | Slightly larger selector surface to maintain in component markup | Eng | Accepted |
| D-035 | 2026-02-21 | 10-closeout | Runtime gate closure method | Accept Node 20 evidence with warnings, rerun full release gate under Node 22 | Re-run complete release gate under Node `v22.12.0` | Aligns final evidence with project runtime requirement and removes environment ambiguity | Requires alternate command path + elevated Playwright execution for local bind | Eng | Accepted |
| D-036 | 2026-02-21 | 10-closeout | Release authorization recording model | Leave deploy-approval checklist unresolved, explicitly record approved state in execution spec + tracker | Explicitly record deploy-approval completion in checklist and tracker | Removes residual process ambiguity and cleanly closes autonomous packet scope | Depends on explicit stakeholder approval timing | Eng | Accepted |

## 10. Execution Updates (2026-02-22)
### Risk Register Updates
| Risk ID | Date | Category | Description | Likelihood | Impact | Score | Phase | Owner | Mitigation | Trigger | Status |
|---|---|---|---|---:|---:|---:|---|---|---|---|---|
| R-036 | 2026-02-22 | Model Calibration | Realized-outcome calibration can overfit sparse setup/regime/time buckets and distort pWin in live ranking. | 3 | 4 | 12 | 12 | Eng | Hierarchical fallback (`bucket -> regime -> type -> global`), Bayesian smoothing priors, conservative blend cap, heuristic fallback when no sample. | Sudden pWin swings in low-trade buckets or unexpected gate-block spikes. | Mitigated |
| R-037 | 2026-02-22 | Nightly Operations | Replay-before-optimize can fail nightly due to reconstruction errors, blocking optimizer promotion. | 3 | 4 | 12 | 12 | Eng | Explicit replay fail-closed controls with env thresholds, deterministic replay window, nightly status persistence + error visibility. | Nightly schedule shows failed run with replay error details. | Mitigated |
| R-038 | 2026-02-22 | Setup Throughput | Macro kill-switch and trend microstructure gates can over-suppress valid setups if floors are too strict for the current regime. | 3 | 4 | 12 | 13 | Eng | Environment-tunable floors/strictness + fail-open microstructure default + explicit gate reason telemetry in optimizer/UI. | Sudden drop in actionable setup count with high `macro_alignment_below_floor` or `microstructure_alignment_required` blockers. | Mitigated |
| R-039 | 2026-02-22 | Fidelity Parity | Historical replay microstructure can diverge from live quote-tape quality if replay only uses bar-level aggregates. | 3 | 4 | 12 | 13 | Eng | Inject synthetic second-bar-derived ticks into setup replay + persist source/metrics in setup metadata so governance can detect parity gaps. | Replay/live blocker mix diverges materially for trend families. | Mitigated |
| R-040 | 2026-02-22 | Contract Starvation | Regime-aware delta bands and 0DTE theta guards can over-prune option candidates, reducing actionable contract recommendations. | 3 | 4 | 12 | 13 | Eng | Keep relaxed filter fallback + calibrate delta/tail-theta bounds with replay diagnostics before tightening further. | Repeated null contract recommendations despite eligible setups. | Mitigated |
| R-041 | 2026-02-22 | Execution Coaching Drift | Deterministic 1R/2R scale instructions can diverge from discretionary user workflows if advisory copy is ambiguous. | 2 | 4 | 8 | 13 | Eng | Encode explicit milestone metadata (`1R`, `2R`, `% scaled`, runner %) and keep advice as guidance only. | User-facing advice appears conflicting or non-actionable in position stream. | Mitigated |
| R-042 | 2026-02-22 | Microstructure Semantics | Using only normalized imbalance can hide ratio-based pressure extremes required by institutional tape checks. | 3 | 4 | 12 | 14 | Eng | Publish dual telemetry contract (`bidAskImbalance` and `askBidSizeRatio`) with quote-coverage + spread context. | Detector thresholds show inconsistent behavior across low/high quote-depth sessions. | Mitigated |
| R-043 | 2026-02-22 | Validation Governance | Top-level eslint invocation in this repo may ignore backend files, reducing static-analysis confidence for backend-only slices. | 2 | 3 | 6 | 14 | Eng | Keep backend unit + backend typecheck as mandatory gates; treat eslint result as informational unless backend lint config is explicitly wired. | Slice claims lint-green without backend lint actually executing. | Open |
| R-044 | 2026-02-22 | Signal Quality | Directional microstructure thresholds in setup-detector stack may be mis-tuned for specific volatility regimes and suppress valid triggers. | 3 | 3 | 9 | 14 | Eng | Keep fail-open when micro unavailable, log microstructure evidence in `signalData`, and calibrate thresholds with replay/trigger-rate review before hardening. | Drop in detector trigger count during sessions with healthy realized follow-through. | Open |
| R-045 | 2026-02-22 | Credential Security | Broker credential storage/decryption path in this foundation slice is placeholder-level and can be misused if promoted without hardening. | 3 | 5 | 15 | 14 | Eng | Keep worker disabled by default, require service-role-only credential operations, and complete KMS/envelope decryption before production broker activation. | Any attempt to enable live broker sync with plaintext/pass-through token handling. | Open |
| R-046 | 2026-02-22 | Recommendation Integrity | Contract recommendation caching can leak stale sizing/0DTE policy across users/risk contexts if cache key omits DTBP/PDT inputs. | 3 | 4 | 12 | 14 | Eng | Include risk fingerprint in cache key and bypass cache on ad-hoc setup payloads. | Mismatched `suggestedContracts` or `zeroDteBlocked` for identical setup under different risk profiles. | Mitigated |
| R-047 | 2026-02-22 | Ledger Reconciliation | Broker-vs-internal symbol normalization mismatches can trigger incorrect force-close actions for open positions. | 3 | 5 | 15 | 14 | Eng | Keep reconciliation disabled-by-default, enforce deterministic SPX OCC normalization (`SPXW -> SPX`), and only mutate rows after successful broker payload parse. | Unexpected closed positions immediately after a reconciliation cycle with active Tradier holdings. | Open |
| R-048 | 2026-02-22 | Throughput Control | Slippage guardrail can ratchet `minEvR` upward and reduce setup throughput in prolonged low-liquidity conditions. | 3 | 4 | 12 | 14 | Eng | Cap max `minEvR`, require minimum sample window, dedupe by fill-window signature, and keep env kill-switch for incidents. | Trigger count compression after repeated slippage guardrail adjustments. | Mitigated |
| R-049 | 2026-02-22 | Promotion Throughput | Strict replay can return zero actionable trades when eligible rows are terminal-hidden at evaluation time, blocking KPI validation despite successful data-fidelity gates. | 4 | 5 | 20 | 14 | Eng | Add explicit throughput gate (`resolvedCount > 0`) and remediate hidden/blocked policy interactions before promotion; verify with strict replay rerun. | Last-week strict replay shows `setupCount=0` with large blocked/hidden counts. | Mitigated (P15 recovered to 7 triggered) |
| R-050 | 2026-02-22 | Grace Quality | ORB sparse-flow grace admits breakout-regime setups without flow confirmation, producing T1=28.57% vs target 70%. | 4 | 4 | 16 | 15 | Eng | Tighten ORB sparse-flow grace (require confluenceScore>=4, add pWin floor, consider regime-conditional admission). | ORB breakout-regime win rate drops below 40% in strict replay. | Open |
| R-051 | 2026-02-22 | Trend Throughput | Trend_pullback setups blocked by `trend_orb_confluence_required` (23) and timing gates (34) despite flow/volume grace elimination. | 3 | 4 | 12 | 15 | Eng | Relax ORB confluence to "ORB level near zone" alternative; widen trend timing windows by 30 min per regime. | Zero trend_pullback triggered in strict replay despite being primary setup family. | Open |

### Decision Log Updates
| Decision ID | Date | Phase | Decision | Options Considered | Chosen Option | Rationale | Tradeoffs | Owner | Status |
|---|---|---|---|---|---|---|---|---|---|
| D-037 | 2026-02-22 | 12 | Setup pWin calibration strategy | Keep heuristic-only pWin, direct empirical replacement, hierarchical smoothed calibration blended with heuristic | Hierarchical smoothed calibration + conservative blend | Preserves live stability while grounding probabilities in realized outcomes and avoiding sparse-bucket overreaction. | Additional model service/cache complexity and DB dependence. | Eng | Accepted |
| D-038 | 2026-02-22 | 12 | Nightly optimization sequence | Optimizer-only nightly scan, replay then scan, replay-only reporting | Replay reconstruction before optimizer scan/promotion | Ensures nightly optimizer decisions use freshest reconstructed Massive-driven setup outcomes. | Nightly run duration and failure surface increase versus scan-only mode. | Eng | Accepted |
| D-039 | 2026-02-22 | 13 | Microstructure source policy for setup scoring | Use minute-bar proxies in all contexts, use live tick-cache microstructure only, require microstructure in all contexts including historical replay | Use live tick-cache microstructure for realtime setup scoring; disable it for historical timestamp runs | Prevents replay contamination from present-time ticks while still upgrading live setup fidelity. | Historical replays remain microstructure-light until historical tick-reconstruction path is added. | Eng | Accepted |
| D-040 | 2026-02-22 | 13 | Macro kill-switch implementation pattern | Hard block by regime conflict only, pure flow gate only, blended macro score with explicit floor and telemetry | Blended macro score with floor (`SPX_SETUP_MACRO_MIN_ALIGNMENT_SCORE`) + explicit gate reason | Produces deterministic, inspectable filtering while preserving tunability across regimes. | Additional configuration surface requires governance discipline. | Eng | Accepted |
| D-041 | 2026-02-22 | 13 | Macro/micro threshold ownership model | Keep env-only static thresholds, fully dynamic profile policy maps, profile maps with env emergency override | Profile-driven maps by setup/regime/time bucket with explicit env emergency override | Enables per-family learning while preserving operator safety override in incidents. | Additional profile complexity and migration burden for legacy scorecards. | Eng | Accepted |
| D-042 | 2026-02-22 | 13 | Optimizer promotion anti-collapse guardrail | Optimize solely for objective/win-rate, enforce trigger-throughput guardrail, hard minimum trade count only | Add trigger-rate + opportunity-throughput guardrail to promotion criteria and scorecard | Prevents deceptive “win rate up, throughput collapsed” promotions and keeps automation behavior auditable. | Can reject some conservative policies that improve precision but lower throughput. | Eng | Accepted |
| D-043 | 2026-02-22 | 13 | Contract strictness strategy | Keep broad delta windows, enforce regime-aware delta bands + setup-family 0DTE rollover + theta caps | Enforce regime-aware delta banding and setup-family rollover/theta guards with relaxed fallback | Improves execution-quality consistency and reduces late-day theta traps while preserving recoverability path. | Candidate pool can shrink if bounds are too strict for current tape quality. | Eng | Accepted |
| D-044 | 2026-02-22 | 13 | Runner exit policy | Continue discretionary PnL-percent exits, move to deterministic milestone exits with structure-aware trailing | Deterministic 1R/2R scale-outs plus pivot-proxy trailing model in advisor guidance | Aligns coaching path with institutional execution discipline and measurable milestone policy. | Requires continued UX tuning to avoid over-prescriptive guidance for discretionary users. | Eng | Accepted |
| D-045 | 2026-02-22 | 14 | Microstructure metric contract shape | Keep only normalized imbalance, switch fully to ratio metric, expose both with explicit purpose | Expose both normalized imbalance and raw ratio telemetry | Preserves compatibility while enabling institutional ratio gating and clearer diagnostics. | Slight increase in payload/model surface area. | Eng | Accepted |
| D-046 | 2026-02-22 | 14 | Detector microstructure gating fallback policy | Fail-closed when micro unavailable, fail-open with telemetry, disable micro gating for detector stack | Fail-open when micro unavailable and enforce directional confirmation only when micro is available/covered | Avoids abrupt detector starvation while adding directional quality control with auditable evidence. | Some low-fidelity sessions may still pass if quote data is sparse. | Eng | Accepted |
| D-047 | 2026-02-22 | 14 | Tradier activation posture | Enable portfolio sync by default, keep it off behind explicit flag until migration/ops readiness is proven | Keep portfolio sync disabled by default (`TRADIER_PORTFOLIO_SYNC_ENABLED=false`) | Prevents accidental live broker calls during foundation rollout while preserving deployability of code paths. | Requires explicit post-deploy enablement step. | Eng | Accepted |
| D-048 | 2026-02-22 | 14 | Recommendation cache scoping for risk-aware sizing | Reuse setup-only cache key, expand key with risk fingerprint and bypass ad-hoc setup cache | Expand cache key with DTBP/PDT fingerprint and bypass cache for explicit setup payloads | Ensures sizing and 0DTE policy fidelity per request context and prevents stale recommendation bleed. | Slightly lower cache-hit ratio and higher short-term compute/load. | Eng | Accepted |
| D-049 | 2026-02-22 | 14 | Broker/internal position parity model | Manual-only parity checks, periodic reconciliation service, strict fail-closed parity | Periodic reconciliation integrated into `positionTrackerWorker` with disabled-by-default runtime flag | Keeps internal trade-state aligned to broker ledger while minimizing rollout risk. | Requires ongoing symbol-key maintenance for cross-underlying option formats. | Eng | Accepted |
| D-050 | 2026-02-22 | 14 | Slippage guardrail persistence model | Runtime-only transient EV floor changes, direct profile mutation without audit, persisted profile+history adjustment path | Persist `minEvR` guardrail bumps in optimizer state/history with window-signature dedupe | Makes execution-friction controls durable, auditable, and revertable in existing governance flow. | Adds a non-scan profile mutation pathway to maintain. | Eng | Accepted |
| D-051 | 2026-02-22 | 14 | Phase 14 promotion decision under zero-throughput replay | Promote on fidelity-only success, block promotion until KPI sample exists | Block promotion until strict replay has non-zero resolved sample and KPI deltas can be measured | Prevents false confidence from "clean gates" when setup throughput is effectively zero. | Extends delivery timeline pending policy recalibration. | Eng | Accepted |
| D-052 | 2026-02-22 | 15 | Flow data availability classification strategy | Keep binary flow presence check, add three-tier classification (available/sparse/unavailable) | Three-tier classification with unified grace condition for all setup types | Enables granular gate behavior based on actual data quality, recovers 102+ flow/volume blocks. | Grace-admitted setups have lower conviction baseline. | Eng | Accepted |
| D-053 | 2026-02-22 | 15 | Optimizer grace parity approach | Keep optimizer separate from detector graces, pass effective booleans via metadata | Persist effectiveFlowConfirmed/effectiveVolumeAligned in setup metadata for optimizer consumption | Ensures optimizer scan sees the same eligible population the detector already approved. | Requires dual-field read pattern in optimizer toPreparedRow. | Eng | Accepted |
| D-054 | 2026-02-22 | 15 | Phase 15 promotion decision | Promote with grace changes despite quality drop, block and iterate | Block promotion — quality (T1=28.57%, expectancy=-0.09R) far below targets despite throughput recovery (0→7) | Flow/volume gate elimination verified successful (102 blocks eliminated). ORB quality in breakout regime requires tightening before promotion. | Extends timeline pending ORB grace recalibration and trend pullback timing relief. | Eng | Accepted |
